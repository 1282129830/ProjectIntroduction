#### 数据库优化

###### 硬件

更快的IO、更多的内存。

######  系统配置（MySQL数据库my.cnf）

1、 选择合适的内存分配算法。

2、 禁用查询缓存（Query Cache）。

3、 使用线程池（Thread Pool）。

4、 合理调整合理调整内存。

###### 数据库表结构

> 表设计

根据数据库三范式来进行表结构的设计。

第一范式：数据表中的每一列（每个字段）必须是不可拆分的最小单元，也就是确保每一列的原子性；

第二范式：满足1NF后，要求表中的所有列，都必须依赖于主键，而不能有任何一列与主键没有关系，也就是说一个表只描述一件事情；

第三范式：满足2NF后，要求表中的每一列只与主键直接相关而不是间接相关，（表中的每一列只能依赖于主键）。说白了就是从表只需要使用外键关联主表，不需要其它主表的冗余字段。

* 有时候可以根据场景合理地反规范化。

> 数据库5大约束

数据库约束是为了保证数据的完整性而实现的一套机制

 A：PRIMARY key：设置主键约束（唯一识别一条记录）。
 B：UNIQUE：设置唯一性约束（数据唯一）。
 C：DEFAULT：默认值约束（提供默认值）。
 D：NOT NULL：设置非空约束（不能为空）。
 E：FOREIGN key：设置外键约束（关联主表数据）。

> 字段类型选择

1.选择更小的数据类型：使用正确地存储和表示数据的最小类型。更小的数据类型通常更快，因为他们使用更少的磁盘空间、内存和CPU缓存。但是要保证实际存储的数据不超过设置。

2.选择简单的数据类型：越简单的数据类型，需要的CPU周期就越少。例如，比较两个整数比比较两个字符串效率更高。时间、IP都可以用integer来存储。

3.尽量避免null：要尽可能地把字段(field)定义为not null。因为MySQL难以优化引用了可空列的查询。因为null，不等于任何值。它会使索引，索引统计和值更加复杂。

4.对于有精度要求的字段，使用decimal。

###### SQL

1. 对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。  

2. 在where子句中应尽量避免 对null值做判断，以及使用 !=，or，in，not in，like，表达式，函数等查询，因为这些操作将会导致引擎放弃使用索引而进行全表扫描。

3. 不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。

4. 在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。